@using System;
@using Interfaces;
@using DAO;
@using Gestione.Controllers;

@{
    ViewBag.Title = "Dettaglio del Mese";
}

<style>
    table {
        font-family: arial, sans-serif;
        border-collapse: collapse;
        width: 100%;
    }

    td {
        border: 1px solid #dddddd;
        text-align: center;
        padding: 8px;
    }

    tr:nth-child(even) {
        background-color: #dddddd;
    }
</style>

<h2>@ViewBag.Title</h2>
<br />
<div>
    @if(ViewBag.Message != null) {
        <h3 class="alert alert-warning">@ViewBag.Message</h3>
    }
    <h4>Inserire l'anno di cui si vogliono visualizzare i dettagli</h4>
</div>
<div>
    <form action="/Home/VisualizzaMese" method="post">
        <select name="anno" required>
            @for(int a = 2000;a<=DateTime.Now.Year; a++){
                <option value="@a" )>
                    @a
                </option>
            }
            <option value="" selected="selected")>
                    Anno
                </option>
        </select>
       
        <input type="submit" value="Visualizza" class="btn info" style="color:white; background-color: #2196F3; background: #0b7dda;" />
    </form>
</div>


@if(ViewBag.Mese!= null) {
    string[] listMesi = { "Gennaio", "Febbraio","Marzo","Aprile","Maggio", "Giugno", "Luglio", "Agosto", "Settembre", "Ottobre", "Novembre", "Dicembre" };

    <br>
    <div class="panel panel-default">
        <table>
            <tr>
                <td>@ViewBag.Year</td>
                @for(int index=0; index < listMesi.Length; index++) { 
                    if(ViewBag.Month == index+1) {
                        <td>@listMesi[index]</td>                   
                    } else {
                        <td style="padding:0; background: #a6a6a6;">
                            <form action="/Home/VisualizzaMese" method="post">
                                <input type="hidden" name="anno" value="@ViewBag.Year" />
                                <input type="hidden" name="mese" value="@(index+1)" />
                                <input type="submit" value="@listMesi[index]" class="btn btn-link" style="color:white; background: #a6a6a6; padding:0;" />
                            </form>
                        </td>
                    }
                }
            </tr>
        </table>
    </div>
}
@if(ViewBag.Mese != null && ViewBag.Mese.Count > 0) {
    <div class="panel panel-default">
        @{ 
            int Nday = DateTime.DaysInMonth(ViewBag.Year, ViewBag.Month);
        }
        <table class="table" style="height:100%; width:100%; padding:0; margin:0;">
            <tr>
                @for(int index = 1; index <= Nday; index++) {
                    <td style="padding:0; background: #a6a6a6;">
                         <form action="/Home/VisualizzaGiorno" method="post">
                                @{
                                    string dataString= new DateTime(ViewBag.Year, ViewBag.Month, index).ToString("yyyy-MM-dd");
                                }
                                <input type="hidden" name="data" value="@dataString" />
                                <input type="submit" value="@index" class="btn btn-link" style="color:white; background: #a6a6a6; padding:0;" />
                          </form>
                    </td>
                }
            </tr>
            <tr>
                @{ 
                    DateTime dateTime = new DateTime(ViewBag.Year, ViewBag.Month,1);
                    for(int i =0; i< Nday;i++) {
                        if(ViewBag.Mese.Contains(new DTGiornoDMese{data = dateTime.AddDays(i) })) {
                            int index = ViewBag.Mese.IndexOf(new DTGiornoDMese { data = dateTime.AddDays(i) });
                            <td style="background:#0080ff; padding:0;">@ViewBag.Mese[index].TotOreLavorate</td>
                        } else { 
                            <td/>
                        }
                    }
                }
            </tr>
            <tr>
                @{ 
                    dateTime = new DateTime(ViewBag.Year, ViewBag.Month,1);
                    for(int i =0; i< Nday;i++) {
                        if(ViewBag.Mese.Contains(new DTGiornoDMese{data = dateTime.AddDays(i) })) {
                            int index = ViewBag.Mese.IndexOf(new DTGiornoDMese { data = dateTime.AddDays(i) });
                            <td style="background:#e6e600; padding:0;">@ViewBag.Mese[index].OrePermesso</td>
                        } else { 
                            <td/>
                        }
                    }
                }
            </tr>
            <tr>
                @{ 
                    dateTime = new DateTime(ViewBag.Year, ViewBag.Month, 1);
                    for(int i =0; i< Nday;i++) {
                        if(ViewBag.Mese.Contains(new DTGiornoDMese{data = dateTime.AddDays(i) })) {
                            int index = ViewBag.Mese.IndexOf(new DTGiornoDMese { data = dateTime.AddDays(i) });
                            <td style="background:#33cc33; padding:0;">@ViewBag.Mese[index].OreFerie</td>
                        } else { 
                            <td/>
                        }
                    }
                }
            </tr>
                <tr>
                @{ 
                    dateTime = new DateTime(ViewBag.Year, ViewBag.Month,1);
                    for(int i =0; i< Nday;i++) {
                        if(ViewBag.Mese.Contains(new DTGiornoDMese{data = dateTime.AddDays(i) })) {
                            int index = ViewBag.Mese.IndexOf(new DTGiornoDMese { data = dateTime.AddDays(i) });
                            <td style="background:#cb3434; padding:0;">@ViewBag.Mese[index].OreMalattia</td>
                        } else { 
                            <td/>
                        }
                    }
                }
            </tr>
        </table>
    </div>
    <div class="container">
        <div class="row">
            <div class="col-md-3">
                Ore Lavoro <label style="background:#0080ff; border:1px solid black; padding:1px 5px 1px 5px">@ViewBag.TOreL</label>
            </div>
            <div class="col-md-3">
                Ore Permesso <label style="background:#e6e600; border:1px solid black; padding:1px 5px 1px 5px">@ViewBag.TOreP</label>
            </div>
            <div class="col-md-3">
                Ore Ferie <label style="background:#33cc33; border:1px solid black; padding:1px 5px 1px 5px">@ViewBag.TOreF</label>
            </div>
            <div class="col-md-3">
                Ore Malattia <label style="background:#cb3434; border:1px solid black; padding:1px 5px 1px 5px">@ViewBag.TOreM</label>
            </div>
        </div>
    </div>
}else if(ViewBag.Mese != null && ViewBag.Mese.Count == 0) {
    <div>
        <h6>Non ci sono dati per il mese indicato.</h6>
    </div>
}
