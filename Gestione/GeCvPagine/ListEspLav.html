
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Esperienze Lavorative</title>
    <script src="http://code.jquery.com/jquery-3.3.1.min.js"
            integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
            crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

    <script>
        var uri = '../api/CV/';
        $(document).ready(function () {
            ListEspLav();
        });
        function ListEspLav(id) {           //LOAD LISTA
            $('#ListEspLav').show( );
            $('#AddE').hide();
            $('#ListEspLav').empty();
            $.getJSON(uri + '/' + id + '/EspLav')
                .done(function (data) {
                    $.each(data, function (key, item) {
                        '<div class="container">'
                        $('#ListEspLav').append('<div class="row"><div class="col-md-6">' + item.Qualifica + '</div><div class="col-md-3"><button class="btn btn-default" onclick="LoadEspLav(' + item.Id + ')"role=button>Dettagli</button></div></div>');
                        '</div>';
                    });
                });
        }
        function LoadEspLav(id) {         //DETTAGLIO
            //$("#AddE").hide();
            $.getJSON('../api/EspLav/'+id)
                .done(function (data) {
                    var $PerStud = $("#DettaglioEsp");
                    $PerStud.find("input[id='esp_AI']").val(data.AnnoInizio);
                    $PerStud.find("input[id='esp_AF']").val(data.AnnoFine);
                    $PerStud.find("input[id='esp_qualifica']").val(data.Qualifica);
                    $PerStud.find("input[id='esp_descrizione']").val(data.Descrizione);
                    $PerStud.find("input[id='esp_id']").val(data.Id);
                });
        }

        function DeleteEsp() {
            event.preventDefault();
            var $form = $("#ModEspLav");
            var idE = $form.find("input[id='esp_id']").val();
            var urlo = "../api/EspLav/Del/" + idE;
            $.ajax({
                url: urlo,
                type: 'DELETE',
                success: function (result) {
                    $('#DettEsp').hide(),
                    ListEspLav()
                },
            });
        }
        function AddEsp() {
            $('#ListEspLav').hide();
            $('#DettEsp').hide();
            $('#AddEsp').html(
                '<div class="container" id="AddE">' +
                '<div class="row">' +
                '<div class="col-md-3">Inizio</div>' +
                '<div class="col-md-3"><input type="number" id="addAi" class="form-control" name="_inizio" placeholder="Data Inizio" /></div>' +
                '<div class="col-md-3">Fine</div>' +
                '<div class="col-md-3"><input type="number" id="addAf" class="form-control" name="_fine" placeholder="Data Fine" /></div></div>' +
                '<div class="row">' +
                '<div class="col-md-3">Qualifica</div>' +
                '<div class="col-md-3"><input type="text" id="addQua" class="form-control" name="_qualifica" placeholder="Qualifica" /></div>' +
                '<div class="col-md-3">Descrizione</div>' +
                '<div class="col-md-3"><input type="text" id="addDesc" class="form-control" name="_desricione" placeholder="Descrizione" /></div></div></div>' +
                '<button class="btn btn-default" onclick="AddEspLav()" role=button>Aggiungi</button>' + '</div>' + '<div>'+
                '<button class="btn btn-default" onclick="Lista()" role=button>Indietro</button>' + '</div>' + '<div>'
            );
        }
        function Lista() {
            $('#ListEspLav').show();
            $('#AddE').hide();
        }
        /*
        function AddEspLav() {
            var esp = {};
            esp.AnnoInizio = $("#addAi").val();
            esp.AnnoFine = $('#addAf').val();
            esp.Qualifica = $('#addQua').val();
            esp.Descrizione = $('#addDesc').val();
            $.ajax({
                data: esp,
                dataType: "application/json",
                url: '../api/CV/EEEE/EspLav',
                type: 'POST',
                success: function (result) {
                    $('#AddE').hide(),
                    $('#ListEspLav').show(),
                    ListEspLav()
                },
            });

        }
        */
        function ModificaEspLav() {         //MODIFICA
            event.preventDefault();
            //event.preventDefault();
            var $form = $("#ModEspLav");
            var idP = $form.find("input[id='esp_id']").val();
            var urlo = "../api/EspLav/Put/" + idP;
            var el = {};
            el.Id = $form.find("input[id='esp_id']").val();
            el.AnnoInizio = $form.find("input[id='esp_AI']").val();
            el.AnnoFine = $form.find("input[id='esp_AF']").val();
            el.Qualifica = $form.find("input[id='esp_qualifica']").val();
            el.Descrizione = $form.find("input[id='esp_descrizione']").val();
            $.ajax({
                url: urlo,
                method: "PUT",
                data: el,
                success: function (data) {

                }
            });
        }

    </script>
</head>
<body>
    <div class="container">
        <div class="page-header">
            <h1>Esperienze Lavorative</h1><button class="btn btn-default" onclick="AddEsp()">Aggiungi</button> 
        </div>
        <div id="AddEsp"></div> 
        <div id="ListEspLav">

        </div> 
        <div id="DettEsp">
            <script>
                $("#DettEsp").load("../GeCvPagine/DettEsp.html", null, null);
            </script>
        </div>
    </div>
</body>
</html>